---
import "../styles/vars.css";
import "../styles/content.css";
import "../styles/layout.css";

import { ClientRouter } from "astro:transitions";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

export interface Props {
    title?: string;
    description?: string;
    children?: any;
}

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content={description || "Official website of illustrator Julia Breckenreid."} />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title || "Julia Breckenreid"}</title>
        <ClientRouter />
        <script is:inline>
            // Theme init
            const theme = (() => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                return "light";
            })();
            if (theme === "dark") {
                document.documentElement.setAttribute("data-theme", "dark");
            } else {
                document.documentElement.removeAttribute("data-theme");
            }
        </script>
    </head>
    <body class="site-wrapper">
        <Header title={title} />

        <main id="site-main" class="site-main">
            <div id="swup" class="transition-fade">
                <slot />
            </div>
        </main>

        <Footer />

        <script>
            import { navigate } from "astro:transitions/client";

            function initNav() {
                const burger = document.querySelector(".nav-burger");
                const wrapper = document.querySelector(".site-wrapper");
                if (burger && wrapper) {
                    burger.addEventListener("click", (e) => {
                        e.preventDefault();
                        wrapper.classList.toggle("site-head-open");
                    });
                }
            }

            function initTheme() {
                const toggleBtn = document.getElementById("theme-toggle");
                const updateIcon = () => {
                    const isDark =
                        document.documentElement.getAttribute("data-theme") ===
                        "dark";
                    // Add logic to animate or swap icons if needed, currently CSS handles visibility? No, added SVGs.
                    // Simple SVG toggle:
                    const sun = document.querySelector(
                        ".sun-icon",
                    ) as HTMLElement;
                    const moon = document.querySelector(
                        ".moon-icon",
                    ) as HTMLElement;
                    if (sun && moon) {
                        sun.style.display = isDark ? "inline-block" : "none";
                        moon.style.display = isDark ? "none" : "inline-block";
                    }
                };

                updateIcon();

                if (toggleBtn) {
                    toggleBtn.addEventListener("click", () => {
                        const currentTheme =
                            document.documentElement.getAttribute("data-theme");
                        const newTheme =
                            currentTheme === "dark" ? "light" : "dark";

                        if (newTheme === "dark") {
                            document.documentElement.setAttribute(
                                "data-theme",
                                "dark",
                            );
                        } else {
                            document.documentElement.removeAttribute(
                                "data-theme",
                            );
                        }
                        localStorage.setItem("theme", newTheme);
                        updateIcon();
                    });
                }
            }

            // Run on view transitions (fires on initial load too)
            document.addEventListener("astro:page-load", () => {
                initNav();
                initTheme();
            });

            // Re-apply theme on swap to prevent flash?
            // The is:inline script in head handles the initial check on reload.
            // astro:after-swap handles verifying state after client-side nav.
            document.addEventListener("astro:after-swap", () => {
                const theme = localStorage.getItem("theme");
                if (
                    theme === "dark" ||
                    (!theme &&
                        window.matchMedia("(prefers-color-scheme: dark)")
                            .matches)
                ) {
                    document.documentElement.setAttribute("data-theme", "dark");
                } else {
                    document.documentElement.removeAttribute("data-theme");
                }
            });
        </script>
    </body>
</html>
