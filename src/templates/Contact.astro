---
import Layout from '../layouts/Layout.astro';
import { type CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'pages'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const { title, description, thumbnail } = entry.data;

// Porting the form HTML.
// Using standard Netlify form submission (no JS hijack required for basic functionality).
---

<Layout title={title} description={description}>
  <article class="contact-form page-template">
    {thumbnail && (
      <div class="post-content-image">
        <img src={thumbnail} class="kg-image" alt={title} />
      </div>
    )}

    <div class="post-content-body">
      <Content />

      <h3 id="forms">Form</h3>
<form
  id="contact-form"
  action="https://formspree.io/f/mvzbbnpd"
  method="POST"
>
  <div class="row gtr-uniform">
    <div class="col-12">
      <input type="text" name="name" placeholder="Name" required />
    </div>

    <div class="col-12">
      <input type="email" name="email" placeholder="Email" required />
    </div>

    <div class="col-12">
      <input type="text" name="organization" placeholder="Publication / Studio (optional)" />
    </div>

    <div class="col-12">
      <select name="project_type">
          <option value="">Project type (optional)</option>
          <option>Editorial illustration</option>
          <option>Book cover / interior</option>
          <option>Series / ongoing</option>
          <option>Licensing / reuse</option>
          <option>General enquiry</option>
      </select>
    </div>

    <div class="col-12">
      <textarea name="message" rows="6" placeholder="Brief / message" required></textarea>
    </div>

    <div class="col-12">
      <ul class="actions">
        <li><input type="submit" value="Send Message" class="primary" /></li>
      </ul>
    </div>
  </div>
</form>
</div>
  </article>
<script>
  const form = document.getElementById("contact-form");

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    const response = await fetch(form.action, {
      method: form.method,
      body: new FormData(form),
      headers: { Accept: "application/json" }
    });

    if (response.ok) {
      window.location.href = "/contact/thanks";
    } else {
      alert("Something went wrong. Please try again.");
    }
  });
</script>
</Layout>
